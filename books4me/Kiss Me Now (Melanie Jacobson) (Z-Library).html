<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes, viewport-fit=cover">
    <title>Kiss Me Now (Melanie Jacobson) (Z-Library) - æœªçŸ¥ä½œè€…</title>
    <style>
:root {
    --bg: #ffffff;
    --bg-rgb: 255, 255, 255;
    --text: #2d3748;
    --accent: #4299e1;
    --light-accent: #e8f4f8;
    --card-bg: #f5fafe;
    --card-shadow: 0 2px 8px rgba(66, 153, 225, 0.15);
    --border-radius: 12px;
    --line-height: 1.8;
    --container-width: 800px;
    --spacing: 32px;
    --progress-height: 4px;
    --header-height: 80px;
    --nav-height: 70px;
}

.dark-mode {
    --bg: #0a0c10;
    --bg-rgb: 26, 32, 44;
    --text: #ffffff;
    --accent: #7472FE;
    --light-accent: #2d3748;
    --card-bg: #2d3748;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "æ€æºé»‘ä½“", "Source Han Sans CN", -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    background-color: var(--bg);
    color: var(--text);
    line-height: var(--line-height);
    transition: background-color 0.3s ease, color 0.3s ease;
}

/* ===== è¿›åº¦æ¡ï¼ˆç‹¬ç«‹fixedï¼‰ ===== */
.progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: var(--progress-height);
    background: linear-gradient(90deg, var(--accent), #7472FE);
    z-index: 101;
    transition: width 0.1s ease;
    pointer-events: none;
}

/* ===== å¤´éƒ¨ç»ç’ƒåŒºåŸŸï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ===== */
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: rgba(var(--bg-rgb), 0.4);
    backdrop-filter: blur(11px);
    border-bottom: 1px solid var(--light-accent);
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    min-height: var(--header-height);
}

.header-left {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 0;
}

/* ä¹¦æ¶é“¾æ¥ - å§‹ç»ˆæ˜¾ç¤ºæ–‡å­— */
.shelf-link {
    display: flex;
    align-items: center;
    gap: 4px;
    text-decoration: none;
    color: var(--accent);
    padding: 8px 4px;
    margin-left: -4px;
    position: relative;
    transition: transform 0.2s ease;
}

/* å¾®åŠ¨æ•ˆï¼šé¦–æ¬¡åŠ è½½è·³åŠ¨ */
@keyframes shelfBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
}

.shelf-link.first-load {
    animation: shelfBounce 0.5s ease 2;
}

/* ç‚¹å‡»åé¦ˆ */
.shelf-link:active {
    transform: scale(0.95);
}

.shelf-icon {
    font-size: 24px;
    line-height: 1;
}

.shelf-text {
    font-size: 12px;
    color: var(--accent);
    opacity: 0.8;
    white-space: nowrap;
    display: inline-block;
}

/* æç«¯å°å±æ‰éšè—æ–‡å­—ï¼ˆå‡ ä¹ä¸ä¼šè§¦å‘ï¼‰ */
@media (max-width: 280px) {
    .shelf-text {
        display: none;
    }
}

.header-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--accent);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 1;
    min-width: 30px;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
}

.progress-text {
    font-size: 18px;
    color: var(--text);
    opacity: 0.9;
    white-space: nowrap;
    font-weight: 500;
    flex-shrink: 0;
}

/* ç§»åŠ¨ç«¯è¿›åº¦æ–‡å­—å‰ç¼€æ§åˆ¶ */
.progress-text::before {
    content: "é˜…è¯»è¿›åº¦ ";
    font-size: inherit;
    color: inherit;
    opacity: 0.8;
}

.theme-toggle {
    background: rgba(255,255,255,0.2);
    border: none;
    padding: 8px 12px;
    border-radius: 20px;
    cursor: pointer;
    color: var(--text);
    font-size: 14px;
    transition: all 0.3s ease;
    backdrop-filter: blur(4px);
    flex-shrink: 0;
}

.theme-toggle:hover {
    background: var(--accent);
    color: white;
}

/* ç§»åŠ¨ç«¯å¤´éƒ¨å“åº”å¼ */
@media (max-width: 428px) {
    .progress-text::before {
        content: "";
    }
}

@media (max-width: 375px) {
    .header-title {
        font-size: 16px;
        max-width: 150px;
    }
    .progress-text {
        font-size: 16px;
    }
}

@media (max-width: 320px) {
    .header-title {
        max-width: 120px;
        font-size: 15px;
    }
    .progress-text {
        font-size: 15px;
        min-width: 45px;
    }
    .theme-toggle {
        padding: 6px 8px;
        font-size: 13px;
    }
}

/* ===== æ­£æ–‡å®¹å™¨ ===== */
.container {
    max-width: var(--container-width);
    margin: 0 auto;
    padding: calc(var(--header-height) + 20px) 16px 120px;
}

/* ===== ç« èŠ‚æ ·å¼ ===== */
.chapter-section {
    margin-bottom: 60px;
    padding-bottom: 40px;
    border-bottom: 1px solid var(--light-accent);
}

.chapter-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 24px;
    color: var(--text);
    border-left: 6px solid var(--accent);
    padding-left: 20px;
    line-height: 1.3;
    transition: border-left-color 0.3s ease;
}

.chapter-title.flash {
    animation: titleFlash 0.5s ease;
}

@keyframes titleFlash {
    0% { border-left-color: var(--accent); }
    50% { border-left-color: #ffaa00; }
    100% { border-left-color: var(--accent); }
}

.chapter-subtitle {
    font-size: 24px;
    font-weight: 600;
    margin: 40px 0 20px;
    color: var(--text);
}

.content p {
    margin-bottom: 20px;
    font-size: 16px;
    line-height: 1.8;
}

/* æ®µè½èŠ‚å¥æ§åˆ¶ */
.content p.short-para {
    margin-bottom: 24px;
}

.content p.medium-para {
    margin-bottom: 16px;
}

.content p.long-para {
    margin-bottom: 32px;
}

/* è§†è§‰åˆ†éš” */
.para-break {
    height: 8px;
    margin: 16px 0;
    opacity: 0.3;
    border-bottom: 1px dashed var(--light-accent);
}

/* ===== å·¥å…·å¡ç‰‡ ===== */
.tools-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin: 32px 0;
}

.tool-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 24px;
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    border: 1px solid rgba(66, 153, 225, 0.1);
}

.tool-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(66, 153, 225, 0.2);
}

.tool-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.tool-tag {
    background-color: var(--accent);
    color: white;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 600;
}

.tool-expand {
    color: var(--accent);
    font-size: 14px;
}

.tool-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
}

.tool-content {
    font-size: 15px;
    margin-bottom: 12px;
    line-height: 1.7;
}

.tool-example {
    display: none;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed var(--light-accent);
    font-size: 14px;
    color: var(--text);
    opacity: 0.9;
}

.tool-example.active {
    display: block;
}

/* ===== ç« èŠ‚å°ç»“ ===== */
.chapter-summary {
    background-color: var(--light-accent);
    border-radius: var(--border-radius);
    padding: 28px;
    margin: 40px 0;
    border-left: 6px solid var(--accent);
}

.summary-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--accent);
}

/* ===== PCç«¯ä¾§è¾¹æ  ===== */
.chapter-sidebar {
    position: fixed;
    left: 30px;
    top: 100px;
    width: 220px;
    z-index: 85;
    display: none;
    overflow-y: auto;
    max-height: calc(100vh - 150px);
}

.chapter-sidebar::-webkit-scrollbar {
    width: 6px;
}

.chapter-sidebar::-webkit-scrollbar-track {
    background: transparent;
}

.chapter-sidebar::-webkit-scrollbar-thumb {
    background: rgba(66, 153, 225, 0.2);
    border-radius: 4px;
}

@media (min-width: 1200px) {
    .chapter-sidebar {
        display: block;
    }
    .container {
        margin-left: 260px;
    }
}

.sidebar-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--light-accent);
    position: sticky;
    top: 0;
    background-color: var(--bg);
    z-index: 86;
    padding-top: 4px;
}

.sidebar-chapters {
    list-style: none;
    margin: 0;
    padding: 0;
}

.sidebar-chapter {
    margin-bottom: 4px;
}

.sidebar-chapter a {
    text-decoration: none;
    color: var(--text);
    font-size: 15px;
    padding: 8px 12px;
    display: block;
    border-radius: 6px;
    transition: background-color 0.2s ease;
    word-break: break-word;
    line-height: 1.4;
}

.sidebar-chapter.active a {
    background-color: var(--light-accent);
    color: var(--accent);
    font-weight: 600;
}

.sidebar-chapter.level-1 a {
    font-weight: 600;
}

.sidebar-chapter.level-2 a {
    padding-left: 24px;
    font-size: 14px;
}

.sidebar-chapter.level-3 a {
    padding-left: 36px;
    font-size: 14px;
}

.sidebar-chapter.level-4 a {
    padding-left: 48px;
    font-size: 13px;
}

/* ===== ç§»åŠ¨ç«¯ä¸“å±æ ·å¼ ===== */
@media (max-width: 1199px) {
    .chapter-sidebar {
        display: none !important;
    }
    
    .container {
        max-width: 100%;
        padding: calc(var(--header-height) + 20px) 16px 100px;
        margin-left: 0;
    }
    
    /* æ­£æ–‡å·¦è¾¹è·ä¸ºè§¦å‘å™¨ç•™å‡ºç©ºé—´ */
    .content {
        margin-left: 48px;
        padding-left: 0;
    }
    
    /* ç« èŠ‚æ ‡é¢˜ä¹Ÿç•™å‡ºç©ºé—´ */
    .chapter-title {
        margin-left: 48px;
        padding-left: 0;
    }
    
    .chapter-subtitle {
        margin-left: 48px;
        padding-left: 0;
    }
    
    /* å·¥å…·å¡ç‰‡å’Œæ‘˜è¦å·¦å¯¹é½ */
    .tools-grid {
        margin-left: 48px;
    }
    
    .chapter-summary {
        margin-left: 48px;
    }
    
    /* ç§»åŠ¨ç«¯å­—ä½“ä¼˜åŒ– */
    .chapter-title {
        font-size: 26px;
    }
    
    .chapter-subtitle {
        font-size: 20px;
    }
    
    .content p {
        font-size: 16px;
        line-height: 1.6;
    }
    
    .tools-grid {
        grid-template-columns: 1fr;
    }
}

/* ===== å·¦ä¾§ç›®å½•è§¦å‘å™¨ï¼ˆåº•éƒ¨å¯¼èˆªæ¡ä¸Šæ–¹ï¼‰ ===== */
.mobile-drawer-trigger {
    position: fixed;
    left: 0;
    bottom: calc(70px + 16px + env(safe-area-inset-bottom, 0));
    width: 32px;
    height: 50px;
    background: rgba(var(--bg-rgb), 0.4);
    backdrop-filter: blur(11px);
    border-top-right-radius: 16px;
    border-bottom-right-radius: 16px;
    border-right: 1px solid rgba(66, 153, 225, 0.2);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 95;
    box-shadow: 2px 0 10px rgba(0,0,0,0.05);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.mobile-drawer-trigger .menu-icon {
    color: var(--accent);
    font-size: 20px;
    font-weight: bold;
    transition: transform 0.3s ease;
}

/* å¾®åŠ¨æ•ˆï¼šé¦–æ¬¡åŠ è½½å‘¼å¸æ•ˆæœ */
@keyframes breathe {
    0% { opacity: 0.4; }
    50% { opacity: 0.8; }
    100% { opacity: 0.4; }
}

.mobile-drawer-trigger.first-load {
    animation: breathe 1s ease 2;
}

/* å‘ä¸Šæ»šåŠ¨å±•å¼€æ•ˆæœ */
.mobile-drawer-trigger.expand {
    width: 80px;
}

.mobile-drawer-trigger.expand .menu-icon {
    margin-right: 4px;
}

.mobile-drawer-trigger.expand::after {
    content: "ğŸ“– ç›®å½•";
    color: var(--text);
    font-size: 13px;
    white-space: nowrap;
    opacity: 0.9;
}

/* é—²ç½®è„‰ææ•ˆæœï¼ˆä»…å‰3æ¬¡ï¼‰ */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.mobile-drawer-trigger.idle {
    animation: pulse 2s ease infinite;
}

/* æŠ½å±‰é¢æ¿ */
.drawer-panel {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 80%;
    max-width: 320px;
    background: rgba(var(--bg-rgb), 0.95);
    backdrop-filter: blur(10px);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 100;
    box-shadow: 4px 0 20px rgba(0,0,0,0.15);
    border-right: 1px solid rgba(66, 153, 225, 0.2);
    overflow-y: auto;
    padding: 20px 0;
}

.drawer-panel.open {
    transform: translateX(0);
}

.drawer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--light-accent);
    margin-bottom: 10px;
}

.drawer-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--accent);
}

.drawer-close {
    width: 32px;
    height: 32px;
    border-radius: 16px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: var(--text);
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
}

.drawer-close:hover {
    background: var(--accent);
    color: white;
}

.drawer-chapters {
    list-style: none;
    padding: 0;
    margin: 0;
}

.drawer-chapter {
    margin: 2px 0;
}

.drawer-chapter a {
    text-decoration: none;
    color: var(--text);
    display: block;
    padding: 10px 20px;
    font-size: 15px;
    line-height: 1.4;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
}

.drawer-chapter a:active {
    background: var(--light-accent);
    border-left-color: var(--accent);
}

.drawer-chapter.active a {
    background: var(--light-accent);
    border-left-color: var(--accent);
    font-weight: 600;
    color: var(--accent);
}

.drawer-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 99;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.drawer-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* ===== åº•éƒ¨å¯¼èˆªæ¡ï¼ˆå…¨å®½è¦†ç›–ï¼Œé€æ˜åº¦ä¼˜åŒ–ï¼‰ ===== */
.chapter-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: rgba(var(--bg-rgb), 0.4);
    backdrop-filter: blur(11px);
    border-top: 1px solid rgba(66, 153, 225, 0.2);
    padding: 0 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 90;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
    /* å®‰å…¨åŒºé€‚é… */
    padding-bottom: env(safe-area-inset-bottom, 0);
    height: calc(70px + env(safe-area-inset-bottom, 0));
}

.nav-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(66, 153, 225, 0.3);
    padding: 0 20px;
    height: 52px;
    border-radius: 26px;
    cursor: pointer;
    color: #4299e1;
    font-size: 15px;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    min-width: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 0 1 auto;
}

.nav-btn:hover:not(:disabled) {
    background: #4299e1;
    color: white;
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
    border-color: transparent;
}

.nav-btn:disabled {
    background: rgba(200, 200, 200, 0.3);
    color: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(200, 200, 200, 0.2);
    box-shadow: none;
    cursor: not-allowed;
    opacity: 0.5;
}

/* è¶…å°å±æŒ‰é’®æ–‡å­—è°ƒæ•´ */
@media (max-width: 375px) {
    .nav-btn {
        padding: 0 12px;
        min-width: 80px;
        font-size: 14px;
    }
}

/* ===== ä¸€é”®é¡¶éƒ¨æŒ‰é’® ===== */
.back-to-top {
    position: fixed;
    bottom: calc(70px + 16px + env(safe-area-inset-bottom, 0));
    right: 16px;
    width: 44px;
    height: 44px;
    border-radius: 22px;
    background: rgba(var(--bg-rgb), 0.4);
    backdrop-filter: blur(11px);
    border: 1px solid rgba(66, 153, 225, 0.2);
    color: var(--accent);
    font-size: 20px;
    cursor: pointer;
    z-index: 91;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: none;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.back-to-top.show {
    display: flex;
}

.back-to-top:hover {
    background: var(--accent);
    color: white;
}

/* ===== æ™ºèƒ½æç¤ºå¡ç‰‡ï¼ˆåº•éƒ¨ä½ç½®ï¼‰ ===== */
.reading-tip {
    position: fixed;
    bottom: calc(70px + 16px + env(safe-area-inset-bottom, 0));
    left: 50%;
    transform: translateX(-50%);
    background: rgba(var(--bg-rgb), 0.2);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 8px 12px;
    color: var(--text);
    font-size: 14px;
    z-index: 96;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    animation: tipFadeIn 0.3s ease;
    pointer-events: none;
    white-space: nowrap;
    max-width: 80%;
    border: 1px solid rgba(66, 153, 225, 0.2);
}

.reading-tip .tip-icon {
    font-size: 14px;
}

.reading-tip.fade-out {
    animation: tipFadeOut 0.2s ease forwards;
}

@keyframes tipFadeIn {
    from { opacity: 0; transform: translate(-50%, 10px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}

@keyframes tipFadeOut {
    from { opacity: 1; transform: translate(-50%, 0); }
    to { opacity: 0; transform: translate(-50%, 10px); }
}

/* è¿›åº¦æ¡é—ªçƒæ•ˆæœ */
@keyframes progressFlash {
    0% { height: var(--progress-height); }
    50% { height: 6px; }
    100% { height: var(--progress-height); }
}

.progress-bar.flash {
    animation: progressFlash 0.3s ease;
}

/* ç§»åŠ¨ç«¯æ˜¾ç¤ºè§¦å‘å™¨ */
@media (max-width: 1199px) {
    .mobile-drawer-trigger {
        display: flex;
    }
}

/* ===== æ·±è‰²æ¨¡å¼é€‚é… ===== */
.dark-mode .mobile-drawer-trigger {
    background: rgba(26, 32, 44, 0.6);
    border-color: rgba(116, 114, 254, 0.3);
}

.dark-mode .drawer-panel {
    background: rgba(10, 12, 16, 0.98);
    border-right-color: rgba(116, 114, 254, 0.2);
}

.dark-mode .chapter-nav {
    background: rgba(26, 32, 44, 0.4);
    border-color: rgba(116, 114, 254, 0.2);
}

.dark-mode .nav-btn {
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(116, 114, 254, 0.4);
    color: #7472FE;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.dark-mode .nav-btn:hover:not(:disabled) {
    background: #7472FE;
    color: white;
    box-shadow: 0 4px 12px rgba(116, 114, 254, 0.3);
}

.dark-mode .nav-btn:disabled {
    background: rgba(50, 50, 50, 0.5);
    color: rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(100, 100, 100, 0.2);
}

.dark-mode .back-to-top {
    background: rgba(26, 32, 44, 0.6);
    border-color: rgba(116, 114, 254, 0.3);
}

.dark-mode .reading-tip {
    background: rgba(26, 32, 44, 0.8);
    border-color: rgba(116, 114, 254, 0.3);
}

.dark-mode .shelf-link,
.dark-mode .shelf-text {
    color: #7472FE;
}
</style>
    <script>
        window.__CHAPTER_DATA__ = [{"total_units": 0, "language_type": "chinese"}, {"total_units": 81, "language_type": "english"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}, {"total_units": 0, "language_type": "mixed"}];
    </script>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    
    <header class="header">
        <div class="header-left">
            <a href="https://luckyme258.github.io/books4me/index.html" class="shelf-link">
                <span class="shelf-icon">ğŸ“š</span>
                <span class="shelf-text">ä¹¦æ¶</span>
            </a>
            <span class="header-title" title="Kiss Me Now (Melanie Jacobson) (Z-Library)">Kiss Me Now (Melanie Jacobson) (Z-Library)</span>
        </div>
        <div class="header-right">
            <span class="progress-text" id="progressText">0%</span>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™ å¤œé—´</button>
        </div>
    </header>
    
    <div class="chapter-sidebar"><div class="sidebar-title">ğŸ“– ç›®å½•</div><ul class="sidebar-chapters">
<li class="sidebar-chapter level-1">
    <a href="#chapter-0" title="Title Page">Title Page</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-1" title="Copyright Page">Copyright Page</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-2" title="Chapter One">Chapter One</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-3" title="Chapter Two">Chapter Two</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-4" title="Chapter Three">Chapter Three</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-5" title="Chapter Four">Chapter Four</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-6" title="Chapter Five">Chapter Five</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-7" title="Chapter Six">Chapter Six</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-8" title="Chapter Seven">Chapter Seven</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-9" title="Chapter Eight">Chapter Eight</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-10" title="Chapter Nine">Chapter Nine</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-11" title="Chapter Ten">Chapter Ten</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-12" title="Chapter Eleven">Chapter Eleven</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-13" title="Chapter Twelve">Chapter Twelve</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-14" title="Chapter Thirteen">Chapter Thirteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-15" title="Chapter Fourteen">Chapter Fourteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-16" title="Chapter Fifteen">Chapter Fifteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-17" title="Chapter Sixteen">Chapter Sixteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-18" title="Chapter Seventeen">Chapter Seventeen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-19" title="Chapter Eighteen">Chapter Eighteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-20" title="Chapter Nineteen">Chapter Nineteen</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-21" title="Chapter Twenty">Chapter Twenty</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-22" title="Chapter Twenty-One">Chapter Twenty-One</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-23" title="Chapter Twenty-Two">Chapter Twenty-Two</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-24" title="Chapter Twenty-Three">Chapter Twenty-Three</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-25" title="Chapter Twenty-Four">Chapter Twenty-Four</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-26" title="Chapter Twenty-Five">Chapter Twenty-Five</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-27" title="Chapter Twenty-Six">Chapter Twenty-Six</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-28" title="Epilogue">Epilogue</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-29" title="Acknowledgments">Acknowledgments</a>
</li>
<li class="sidebar-chapter level-1">
    <a href="#chapter-30" title="About the Author">About the Author</a>
</li></ul></div>
    
    <div class="container">
        <section class="chapter-section">
<h1 class="chapter-title" id="chapter-0">
    Title Page
</h1>
<div class="content"><p class="short-para">[å†…å®¹æå–å¯èƒ½ä¸å®Œæ•´]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-1">
    Copyright Page
</h1>
<div class="content"><p class="short-para">Copyright Â© 2021 by Melanie Jacobson</p><p class="medium-para">All rights reserved. No part of this publication may be reproduced, distributed, or transmitted in any form or by any means, without prior written permission.</p><p class="short-para">Melanie Jacobson</p><p class="short-para">11923 NE Sumner St.</p><p class="short-para">STE 317019</p><p class="short-para">Portland, OR. 97250</p><p class="long-para">Publisherâ€™s Note: This is a work of fiction. Names, characters, places, and incidents are a product of the authorâ€™s imagination. Locales and public names are sometimes used for atmospheric purposes. Any resemblance to actual people, events, institutions, or locals is completely incidental.</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-2">
    Chapter One
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-3">
    Chapter Two
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-4">
    Chapter Three
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-5">
    Chapter Four
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-6">
    Chapter Five
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-7">
    Chapter Six
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-8">
    Chapter Seven
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-9">
    Chapter Eight
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-10">
    Chapter Nine
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-11">
    Chapter Ten
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-12">
    Chapter Eleven
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-13">
    Chapter Twelve
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-14">
    Chapter Thirteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-15">
    Chapter Fourteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-16">
    Chapter Fifteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-17">
    Chapter Sixteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-18">
    Chapter Seventeen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-19">
    Chapter Eighteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-20">
    Chapter Nineteen
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-21">
    Chapter Twenty
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-22">
    Chapter Twenty-One
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-23">
    Chapter Twenty-Two
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-24">
    Chapter Twenty-Three
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-25">
    Chapter Twenty-Four
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-26">
    Chapter Twenty-Five
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-27">
    Chapter Twenty-Six
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-28">
    Epilogue
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-29">
    Acknowledgments
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section><section class="chapter-section">
<h1 class="chapter-title" id="chapter-30">
    About the Author
</h1>
<div class="content"><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p><p class="short-para">[å›¾ç‰‡: image]</p></div></section>
    </div>
    
    <div class="chapter-nav">
        <button class="nav-btn" id="prevChapter" disabled>â† ä¸Šä¸€ç« </button>
        <button class="nav-btn" id="nextChapter">ä¸‹ä¸€ç«  â†’</button>
    </div>
    
    <script>
// ===== ç»Ÿä¸€çš„å¯¼èˆªç®¡ç†å™¨ =====
(function() {
    'use strict';
    
    // ========== æ ¸å¿ƒçŠ¶æ€ ==========
    const state = {
        currentChapter: 0,
        totalChapters: 0,
        mode: 'desktop',
        chapters: [],
        chapterData: [],
        readingStartTime: Date.now(),
        chaptersCompleted: 0,
        lastTipTime: 0,
        fatigueLevel: 1.0,
        lastLanguageSwitch: 0,
        technicalTermCount: 0,
        tipCount: 0,
        drawerClickCount: 0,
        shelfClickCount: 0  // è®°å½•ä¹¦æ¶ç‚¹å‡»æ¬¡æ•°
    };
    
    // ========== DOMå…ƒç´ ç¼“å­˜ ==========
    const elements = {
        header: null,
        chapters: [],
        sidebarChapters: [],
        progressBar: null,
        progressText: null,
        prevBtn: null,
        nextBtn: null,
        themeToggle: null,
        shelfLink: null
    };
    
    // ========== ç§»åŠ¨ç«¯å…ƒç´  ==========
    const mobile = {
        drawerTrigger: null,
        drawerPanel: null,
        drawerClose: null,
        drawerOverlay: null,
        drawerChapters: null,
        backToTop: null
    };
    
    // ========== ç« èŠ‚æ•°æ® ==========
    window.__CHAPTER_DATA__ = window.__CHAPTER_DATA__ || [];
    
    // ========== æç¤ºè¯­åº“ ==========
    const tipMessages = {
        chinese: {
            short: [
                { icon: "âœŒï¸", text: "è¿™ä¸€èŠ‚getåˆ°äº†" },
                { icon: "ğŸ“–", text: "åˆè¯»å®Œä¸€å°èŠ‚" },
                { icon: "âœ¨", text: "çŸ¥è¯†ç‚¹+1" }
            ],
            medium: [
                { icon: "ğŸŒ±", text: "ç†è§£åŠ æ·±ä¸­" },
                { icon: "ğŸ’ª", text: "çŠ¶æ€ä¸é”™ï¼Œç»§ç»­" },
                { icon: "ğŸ”", text: "è¿™ä¸ªè§‚ç‚¹æœ‰æ„æ€" }
            ],
            long: [
                { icon: "ğŸƒ", text: "å·²ç»è¯»å®Œ1/3äº†" },
                { icon: "â›°ï¸", text: "åŠå±±è…°äº†ï¼ŒåŠ æ²¹" },
                { icon: "ğŸª", text: "å¿«åˆ°ç« èŠ‚ç»“å°¾äº†" }
            ]
        },
        mixed: {
            short: [
                { icon: "ğŸŒ", text: "ä¸­è‹±åˆ‡æ¢è‡ªå¦‚" },
                { icon: "ğŸ¯", text: "Technical terms get!" },
                { icon: "ğŸ“š", text: "Bilingual reading" }
            ],
            medium: [
                { icon: "ğŸŒ", text: "Great progress!" },
                { icon: "âš¡", text: "You're on fire!" },
                { icon: "ğŸ’¡", text: "ç†è§£æ— å›½ç•Œ" }
            ],
            long: [
                { icon: "ğŸ“Š", text: "Halfway through" },
                { icon: "ğŸš€", text: "ä¿æŒè¿™ä¸ªèŠ‚å¥" },
                { icon: "ğŸ¯", text: "ç›®æ ‡è¶Šæ¥è¶Šè¿‘" }
            ]
        },
        english: {
            short: [
                { icon: "ğŸŒ", text: "Great progress!" },
                { icon: "âš¡", text: "You're on fire!" },
                { icon: "ğŸ¯", text: "Nailing it!" }
            ],
            medium: [
                { icon: "ğŸ’ª", text: "Keep going!" },
                { icon: "ğŸŒŸ", text: "You're doing great" },
                { icon: "ğŸ“ˆ", text: "Making progress" }
            ],
            long: [
                { icon: "ğŸƒ", text: "1/3 done, keep it up" },
                { icon: "â›°ï¸", text: "Halfway there" },
                { icon: "ğŸª", text: "Almost there" }
            ]
        },
        milestone: {
            25: { icon: "ğŸ", text: "å¾ç¨‹å¼€å§‹ï¼Œå·²å®Œæˆ1/4" },
            50: { icon: "ğŸª", text: "åŠç¨‹å›é¡¾ï¼Œæ”¶è·æ»¡æ»¡" },
            75: { icon: "ğŸš€", text: "å†²åˆºé˜¶æ®µï¼Œå³å°†å®Œæˆ" },
            100: { icon: "ğŸ†", text: "æ­å–œï¼ä½ è¯»å®Œäº†æ•´æœ¬ä¹¦" }
        },
        rest: [
            { icon: "â˜•", text: "ç´¯äº†ï¼Ÿä¼‘æ¯ä¸€ä¸‹" },
            { icon: "ğŸ§˜", text: "çœ¼ç›éœ€è¦æ”¾æ¾" },
            { icon: "ğŸŒ™", text: "è¯»å®Œè¿™ç« å°±ä¼‘æ¯" }
        ],
        timeBased: {
            morning: { icon: "ğŸŒ…", text: "æ—©å®‰ï¼Œç”¨é˜…è¯»å¼€å¯æ–°çš„ä¸€å¤©" },
            night: { icon: "ğŸŒ™", text: "å¤œæ·±äº†ï¼Œè¯»å®Œè¿™ç« å°±ä¼‘æ¯å§" },
            long: { icon: "â°", text: "å·²ä¸“æ³¨é˜…è¯» {minutes} åˆ†é’Ÿ" }
        }
    };
    
    // ========== åˆå§‹åŒ– ==========
    function init() {
        cacheElements();
        loadChapterData();
        detectMode();
        setupMobileElements();
        setupEventListeners();
        setupResizeListener();
        loadThemePreference();
        initReadingTracker();
        initShelfAnimation();
        
        if (elements.chapters.length > 0) {
            state.totalChapters = elements.chapters.length;
            state.chapterData = window.__CHAPTER_DATA__;
            goToChapter(0);
            
            // é¦–æ¬¡åŠ è½½æ˜¾ç¤ºæ¬¢è¿æç¤º
            setTimeout(() => {
                const hour = new Date().getHours();
                if (hour >= 5 && hour <= 8) {
                    showTip(tipMessages.timeBased.morning.icon, tipMessages.timeBased.morning.text, 2000);
                } else if (hour >= 22 || hour <= 4) {
                    showTip(tipMessages.timeBased.night.icon, tipMessages.timeBased.night.text, 2000);
                }
            }, 1000);
        }
    }
    
    // ========== ä¹¦æ¶æŒ‰é’®åŠ¨ç”»åˆå§‹åŒ– ==========
    function initShelfAnimation() {
        if (!elements.shelfLink) return;
        
        // ä»localStorageè¯»å–ä¹¦æ¶ç‚¹å‡»æ¬¡æ•°
        const saved = localStorage.getItem('shelfClickCount');
        state.shelfClickCount = saved ? parseInt(saved) : 0;
        
        // å‰3æ¬¡æ˜¾ç¤ºåŠ¨æ•ˆ
        if (state.shelfClickCount < 3) {
            elements.shelfLink.classList.add('first-load');
            
            // 3ç§’åç§»é™¤åŠ¨æ•ˆï¼ˆé¿å…ä¸€ç›´è·³åŠ¨ï¼‰
            setTimeout(() => {
                elements.shelfLink.classList.remove('first-load');
            }, 3000);
        }
        
        // ç‚¹å‡»äº‹ä»¶
        elements.shelfLink.addEventListener('click', (e) => {
            // å¢åŠ ç‚¹å‡»æ¬¡æ•°
            state.shelfClickCount++;
            localStorage.setItem('shelfClickCount', state.shelfClickCount);
            
            // ç§»é™¤åŠ¨æ•ˆ
            elements.shelfLink.classList.remove('first-load');
            
            // å®é™…è·³è½¬ç”±hrefå¤„ç†ï¼Œä¸éœ€è¦é¢å¤–æ“ä½œ
        });
    }
    
    // ========== åŠ è½½ç« èŠ‚æ•°æ® ==========
    function loadChapterData() {
        console.log('ğŸ“š åŠ è½½ç« èŠ‚æ•°æ®:', window.__CHAPTER_DATA__.length, 'ç« ');
    }
    
    // ========== ç¼“å­˜DOMå…ƒç´  ==========
    function cacheElements() {
        elements.header = document.querySelector('.header');
        elements.chapters = document.querySelectorAll('.chapter-section');
        elements.sidebarChapters = document.querySelectorAll('.sidebar-chapter');
        elements.progressBar = document.getElementById('progressBar');
        elements.progressText = document.getElementById('progressText');
        elements.prevBtn = document.getElementById('prevChapter');
        elements.nextBtn = document.getElementById('nextChapter');
        elements.themeToggle = document.getElementById('themeToggle');
        elements.shelfLink = document.querySelector('.shelf-link');
    }
    
    // ========== æ¨¡å¼æ£€æµ‹ ==========
    function detectMode() {
        state.mode = window.innerWidth > 1200 ? 'desktop' : 'mobile';
        document.body.setAttribute('data-mode', state.mode);
    }
    
    // ========== è®¾ç½®å“åº”å¼ç›‘å¬ ==========
    function setupResizeListener() {
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const newMode = window.innerWidth > 1200 ? 'desktop' : 'mobile';
                if (newMode !== state.mode) {
                    state.mode = newMode;
                    document.body.setAttribute('data-mode', state.mode);
                }
            }, 250);
        });
    }
    
    // ========== é˜…è¯»è¿½è¸ªåˆå§‹åŒ– ==========
    function initReadingTracker() {
        state.readingStartTime = Date.now();
        
        const saved = localStorage.getItem('readingStats');
        if (saved) {
            try {
                const stats = JSON.parse(saved);
                state.chaptersCompleted = stats.chaptersCompleted || 0;
                state.tipCount = stats.tipCount || 0;
                state.drawerClickCount = stats.drawerClickCount || 0;
            } catch (e) {}
        }
        
        // æ¯10åˆ†é’Ÿæ›´æ–°ç–²åŠ³åº¦
        setInterval(updateFatigueLevel, 60000);
    }
    
    // ========== æ›´æ–°ç–²åŠ³åº¦ ==========
    function updateFatigueLevel() {
        const minutes = Math.floor((Date.now() - state.readingStartTime) / 60000);
        state.fatigueLevel = 1.0 + (minutes * 0.1);
        
        const lastSwitch = (Date.now() - state.lastLanguageSwitch) / 60000;
        if (lastSwitch < 5) {
            state.fatigueLevel += 0.2;
        }
        
        state.fatigueLevel += state.technicalTermCount * 0.01;
        state.fatigueLevel = Math.min(state.fatigueLevel, 3.0);
        
        if (state.fatigueLevel > 2.0) {
            showRestTip();
        }
    }
    
    // ========== ä¿å­˜é˜…è¯»æ•°æ® ==========
    function saveReadingStats() {
        const stats = {
            chaptersCompleted: state.chaptersCompleted,
            tipCount: state.tipCount,
            drawerClickCount: state.drawerClickCount,
            lastRead: new Date().toISOString()
        };
        localStorage.setItem('readingStats', JSON.stringify(stats));
    }
    
    // ========== æ˜¾ç¤ºæ™ºèƒ½æç¤º ==========
    function showTip(icon, text, duration = 3000) {
        const now = Date.now();
        const hourAgo = now - 3600000;
        if (state.lastTipTime > hourAgo && state.tipCount >= 3) {
            return;
        }
        
        if (state.fatigueLevel > 2.5 && Math.random() > 0.3) {
            return;
        }
        
        state.lastTipTime = now;
        state.tipCount++;
        saveReadingStats();
        
        const oldTip = document.querySelector('.reading-tip');
        if (oldTip) oldTip.remove();
        
        const tip = document.createElement('div');
        tip.className = 'reading-tip';
        tip.innerHTML = `<span class="tip-icon">${icon}</span><span class="tip-text">${text}</span>`;
        document.body.appendChild(tip);
        
        setTimeout(() => {
            tip.classList.add('fade-out');
            setTimeout(() => tip.remove(), 200);
        }, duration);
    }
    
    // ========== æ˜¾ç¤ºä¼‘æ¯æç¤º ==========
    function showRestTip() {
        const rest = tipMessages.rest[Math.floor(Math.random() * tipMessages.rest.length)];
        showTip(rest.icon, rest.text, 2000);
    }
    
    // ========== æ ¹æ®åœºæ™¯è·å–ç« èŠ‚æç¤º ==========
    function getChapterTip(chapterIndex, progress) {
        const chapter = state.chapterData[chapterIndex];
        if (!chapter) return null;
        
        const languageType = chapter.language_type || 'chinese';
        const totalUnits = chapter.total_units || 500;
        
        let lengthType = 'medium';
        if (totalUnits < 500) lengthType = 'short';
        else if (totalUnits > 1500) lengthType = 'long';
        
        let tipPool;
        if (progress === 'complete') {
            if (languageType === 'chinese') tipPool = tipMessages.chinese[lengthType];
            else if (languageType === 'english') tipPool = tipMessages.english[lengthType];
            else tipPool = tipMessages.mixed[lengthType];
        } else {
            if (languageType === 'chinese') tipPool = tipMessages.chinese.medium;
            else if (languageType === 'english') tipPool = tipMessages.english.medium;
            else tipPool = tipMessages.mixed.medium;
        }
        
        if (!tipPool || tipPool.length === 0) return null;
        
        return tipPool[Math.floor(Math.random() * tipPool.length)];
    }
    
    // ========== æ£€æŸ¥å¹¶è§¦å‘ç« èŠ‚æç¤º ==========
    function checkChapterTip(chapterIndex, isComplete = false) {
        const chapter = state.chapterData[chapterIndex];
        if (!chapter) return;
        
        const totalUnits = chapter.total_units || 500;
        const languageType = chapter.language_type || 'chinese';
        
        let baseProbability = 0.3;
        
        if (isComplete) {
            if (totalUnits < 500) baseProbability = 0.2;
            else if (totalUnits < 1500) baseProbability = 1.0;
            else baseProbability = 1.0;
        } else {
            if (languageType === 'chinese') baseProbability = 0.4;
            else if (languageType === 'english') baseProbability = 0.8;
            else baseProbability = 0.6;
        }
        
        baseProbability *= (1 + (state.fatigueLevel - 1.0) * 0.5);
        
        if (Math.random() > baseProbability) return;
        
        const tip = getChapterTip(chapterIndex, isComplete ? 'complete' : 'midway');
        if (tip) {
            showTip(tip.icon, tip.text);
            
            if (isComplete) {
                if (elements.progressBar) {
                    elements.progressBar.classList.add('flash');
                    setTimeout(() => elements.progressBar.classList.remove('flash'), 300);
                }
                
                const titleElement = document.getElementById(`chapter-${chapterIndex}`);
                if (titleElement) {
                    titleElement.classList.add('flash');
                    setTimeout(() => titleElement.classList.remove('flash'), 500);
                }
            }
        }
    }
    
    // ========== æ£€æŸ¥å…¨ä¹¦é‡Œç¨‹ç¢‘ ==========
    function checkMilestone() {
        const percent = Math.round((state.currentChapter + 1) / state.totalChapters * 100);
        
        if ([25, 50, 75, 100].includes(percent)) {
            const milestone = tipMessages.milestone[percent];
            if (milestone) {
                showTip(milestone.icon, milestone.text, 4000);
                
                if (percent === 100 && elements.progressBar) {
                    elements.progressBar.style.height = '8px';
                    setTimeout(() => {
                        elements.progressBar.style.height = 'var(--progress-height)';
                    }, 2000);
                }
            }
        }
    }
    
    // ========== åˆ›å»ºç§»åŠ¨ç«¯å…ƒç´  ==========
    function setupMobileElements() {
        const drawerHTML = `
            <div class="mobile-drawer-trigger" id="drawerTrigger">
                <span class="menu-icon">â˜°</span>
            </div>
            <div class="drawer-panel" id="drawerPanel">
                <div class="drawer-header">
                    <span class="drawer-title">ğŸ“– ç›®å½•</span>
                    <button class="drawer-close" id="drawerClose">âœ•</button>
                </div>
                <ul class="drawer-chapters" id="drawerChapters"></ul>
            </div>
            <div class="drawer-overlay" id="drawerOverlay"></div>
            <button class="back-to-top" id="backToTop">â†‘</button>
        `;
        
        document.body.insertAdjacentHTML('afterbegin', drawerHTML);
        
        mobile.drawerTrigger = document.getElementById('drawerTrigger');
        mobile.drawerPanel = document.getElementById('drawerPanel');
        mobile.drawerClose = document.getElementById('drawerClose');
        mobile.drawerOverlay = document.getElementById('drawerOverlay');
        mobile.drawerChapters = document.getElementById('drawerChapters');
        mobile.backToTop = document.getElementById('backToTop');
        
        mobile.drawerTrigger.classList.add('first-load');
        setTimeout(() => {
            mobile.drawerTrigger.classList.remove('first-load');
        }, 2000);
        
        populateDrawer();
        bindMobileEvents();
        setupScrollTrigger();
    }
    
    // ========== å¡«å……æŠ½å±‰ç›®å½• ==========
    function populateDrawer() {
        if (!mobile.drawerChapters || !elements.sidebarChapters.length) return;
        
        elements.sidebarChapters.forEach(item => {
            const link = item.querySelector('a');
            if (link) {
                const newLi = document.createElement('li');
                newLi.className = item.className;
                newLi.innerHTML = link.outerHTML;
                mobile.drawerChapters.appendChild(newLi);
            }
        });
    }
    
    // ========== æ»šåŠ¨è§¦å‘å™¨é€»è¾‘ ==========
    function setupScrollTrigger() {
        let lastScrollTop = 0;
        let expandTimer;
        let idleTimer;
        
        window.addEventListener('scroll', () => {
            if (!mobile.drawerTrigger) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop < lastScrollTop && state.mode === 'mobile') {
                clearTimeout(expandTimer);
                mobile.drawerTrigger.classList.add('expand');
                
                expandTimer = setTimeout(() => {
                    mobile.drawerTrigger.classList.remove('expand');
                }, 1500);
            }
            
            lastScrollTop = scrollTop;
            
            clearTimeout(idleTimer);
            mobile.drawerTrigger.classList.remove('idle');
            
            idleTimer = setTimeout(() => {
                if (state.mode === 'mobile' && !mobile.drawerPanel.classList.contains('open') && state.drawerClickCount < 3) {
                    mobile.drawerTrigger.classList.add('idle');
                }
            }, 3000);
        });
    }
    
    // ========== ç»‘å®šç§»åŠ¨ç«¯äº‹ä»¶ ==========
    function bindMobileEvents() {
        if (!mobile.drawerTrigger || !mobile.drawerClose || !mobile.drawerOverlay) return;
        
        mobile.drawerTrigger.addEventListener('click', () => {
            toggleDrawer();
            
            state.drawerClickCount++;
            saveReadingStats();
            
            if (!localStorage.getItem('drawerUsed')) {
                showTip("ğŸ“–", "ç›®å½•å·²æ‰“å¼€");
                localStorage.setItem('drawerUsed', 'true');
            }
        });
        
        mobile.drawerClose.addEventListener('click', closeDrawer);
        mobile.drawerOverlay.addEventListener('click', closeDrawer);
        
        let touchStartX = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            
            if (touchStartX < 30 && touchEndX - touchStartX > 50) {
                if (!mobile.drawerPanel?.classList.contains('open')) {
                    openDrawer();
                }
            }
            
            if (mobile.drawerPanel?.classList.contains('open') && touchStartX - touchEndX > 50) {
                closeDrawer();
            }
        });
        
        if (mobile.backToTop) {
            mobile.backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }
    
    // ========== ç»‘å®šæ‰€æœ‰äº‹ä»¶ ==========
    function setupEventListeners() {
        window.addEventListener('scroll', handleScroll);
        
        if (elements.themeToggle) {
            elements.themeToggle.addEventListener('click', toggleTheme);
        }
        
        document.querySelectorAll('.tool-card').forEach(card => {
            card.addEventListener('click', toggleToolExample);
        });
        
        if (elements.prevBtn) {
            elements.prevBtn.addEventListener('click', () => goToChapter(state.currentChapter - 1));
        }
        if (elements.nextBtn) {
            elements.nextBtn.addEventListener('click', () => goToChapter(state.currentChapter + 1));
        }
        
        document.addEventListener('click', (e) => {
            const link = e.target.closest('.sidebar-chapter a, .drawer-chapter a');
            if (link) {
                e.preventDefault();
                const href = link.getAttribute('href');
                const chapterId = parseInt(href.replace('#chapter-', ''));
                goToChapter(chapterId);
            }
        });
    }
    
    // ========== è·³è½¬åˆ°æŒ‡å®šç« èŠ‚ ==========
    function goToChapter(index) {
        if (index < 0 || index >= state.totalChapters) return;
        
        const wasLastChapter = state.currentChapter === state.totalChapters - 1;
        const previousChapter = state.currentChapter;
        state.currentChapter = index;
        
        elements.chapters.forEach((chap, i) => {
            chap.style.display = i === index ? 'block' : 'none';
        });
        
        if (elements.prevBtn) elements.prevBtn.disabled = index === 0;
        if (elements.nextBtn) elements.nextBtn.disabled = index === state.totalChapters - 1;
        
        scrollToChapter(index);
        updateAllHighlights();
        
        if (previousChapter !== index && !wasLastChapter) {
            state.chaptersCompleted++;
            saveReadingStats();
            
            checkChapterTip(previousChapter, true);
            checkMilestone();
            
            const minutes = Math.floor((Date.now() - state.readingStartTime) / 60000);
            if (minutes > 0 && minutes % 10 === 0 && minutes <= 60) {
                const timeTip = tipMessages.timeBased.long;
                showTip(timeTip.icon, timeTip.text.replace('{minutes}', minutes));
            }
        }
        
        if (state.mode === 'mobile' && mobile.drawerPanel?.classList.contains('open')) {
            closeDrawer();
        }
    }
    
    // ========== æ»šåŠ¨åˆ°ç« èŠ‚ ==========
    function scrollToChapter(index) {
        const chapterElement = document.getElementById(`chapter-${index}`);
        if (!chapterElement) return;
        
        const headerHeight = elements.header ? elements.header.offsetHeight : 80;
        const rect = chapterElement.getBoundingClientRect();
        const scrollTo = window.pageYOffset + rect.top - headerHeight - 20;
        
        window.scrollTo({
            top: Math.max(0, scrollTo),
            behavior: 'smooth'
        });
    }
    
    // ========== æ›´æ–°é«˜äº® ==========
    function updateAllHighlights() {
        document.querySelectorAll('.sidebar-chapter, .drawer-chapter').forEach(item => {
            item.classList.remove('active');
        });
        
        const activeSidebarItem = document.querySelectorAll('.sidebar-chapter')[state.currentChapter];
        if (activeSidebarItem) activeSidebarItem.classList.add('active');
        
        if (mobile.drawerChapters) {
            const activeDrawerItem = mobile.drawerChapters.querySelectorAll('.sidebar-chapter')[state.currentChapter];
            if (activeDrawerItem) activeDrawerItem.classList.add('active');
        }
    }
    
    // ========== æ»šåŠ¨å¤„ç† ==========
    function handleScroll() {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        
        if (elements.progressBar) {
            elements.progressBar.style.width = scrolled + '%';
        }
        
        if (elements.progressText) {
            elements.progressText.textContent = `${Math.round(scrolled)}%`;
        }
        
        if (mobile.backToTop) {
            if (winScroll > window.innerHeight) {
                mobile.backToTop.classList.add('show');
            } else {
                mobile.backToTop.classList.remove('show');
            }
        }
        
        detectCurrentChapter();
        
        const currentChapterData = state.chapterData[state.currentChapter];
        if (currentChapterData) {
            const chapterElement = document.getElementById(`chapter-${state.currentChapter}`);
            if (chapterElement) {
                const rect = chapterElement.getBoundingClientRect();
                const totalHeight = rect.height;
                const scrolledInChapter = Math.abs(rect.top);
                
                if (totalHeight > 0) {
                    const progress = scrolledInChapter / totalHeight;
                    if (progress > 0.3 && progress < 0.4 && !sessionStorage.getItem('tip-30')) {
                        checkChapterTip(state.currentChapter, false);
                        sessionStorage.setItem('tip-30', 'true');
                    } else if (progress > 0.6 && progress < 0.7 && !sessionStorage.getItem('tip-60')) {
                        checkChapterTip(state.currentChapter, false);
                        sessionStorage.setItem('tip-60', 'true');
                    }
                }
            }
        }
    }
    
    // ========== æ£€æµ‹å½“å‰ç« èŠ‚ ==========
    function detectCurrentChapter() {
        const headerHeight = elements.header ? elements.header.offsetHeight : 80;
        
        for (let i = 0; i < elements.chapters.length; i++) {
            const titleElement = document.getElementById(`chapter-${i}`);
            if (titleElement) {
                const rect = titleElement.getBoundingClientRect();
                if (rect.top <= headerHeight + 50 && rect.bottom > headerHeight) {
                    if (state.currentChapter !== i) {
                        state.currentChapter = i;
                        updateAllHighlights();
                        sessionStorage.removeItem('tip-30');
                        sessionStorage.removeItem('tip-60');
                    }
                    break;
                }
            }
        }
    }
    
    // ========== æŠ½å±‰æ§åˆ¶ ==========
    function toggleDrawer() {
        if (mobile.drawerPanel?.classList.contains('open')) {
            closeDrawer();
        } else {
            openDrawer();
        }
    }
    
    function openDrawer() {
        if (!mobile.drawerPanel || !mobile.drawerOverlay) return;
        mobile.drawerPanel.classList.add('open');
        mobile.drawerOverlay.classList.add('active');
    }
    
    function closeDrawer() {
        if (!mobile.drawerPanel || !mobile.drawerOverlay) return;
        mobile.drawerPanel.classList.remove('open');
        mobile.drawerOverlay.classList.remove('active');
    }
    
    // ========== ä¸»é¢˜åˆ‡æ¢ ==========
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        if (elements.themeToggle) {
            elements.themeToggle.textContent = isDark ? 'â˜€ï¸ æ—¥é—´' : 'ğŸŒ™ å¤œé—´';
        }
        localStorage.setItem('darkMode', isDark ? '1' : '0');
    }
    
    // ========== å·¥å…·å¡ç‰‡ ==========
    function toggleToolExample(e) {
        e.stopPropagation();
        const card = e.currentTarget;
        const example = card.querySelector('.tool-example');
        const expandText = card.querySelector('.tool-expand');
        
        if (example) {
            example.classList.toggle('active');
            if (expandText) {
                expandText.textContent = example.classList.contains('active') ? 'æ”¶èµ·ç¤ºä¾‹' : 'æŸ¥çœ‹ç¤ºä¾‹';
            }
        }
    }
    
    // ========== åŠ è½½ä¸»é¢˜åå¥½ ==========
    function loadThemePreference() {
        if (localStorage.getItem('darkMode') === '1') {
            document.body.classList.add('dark-mode');
            if (elements.themeToggle) {
                elements.themeToggle.textContent = 'â˜€ï¸ æ—¥é—´';
            }
        }
    }
    
    // ========== å¯åŠ¨ ==========
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>
</body>
</html>